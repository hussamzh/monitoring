---
- name: Install Grafana on the system
  hosts: control
  tasks:
    - name: Install Grafana on Debian Systems
      when: ansible_os_family == "Debian"
      become: true
      block:
        - name: Downlaod Grafana GPG key for debian
          ansible.builtin.get_url:
            url: https://apt.grafana.com/gpg.key
            dest: /usr/share/keyrings/grafana.key
            mode: '0644'

        - name: Add Grafana apt repository on Debian
          ansible.builtin.copy:
            dest: /etc/apt/sources.list.d/grafana.list
            content: |
              deb [signed-by=/usr/share/keyrings/grafana.key] https://apt.grafana.com stable main
            mode: '0644'

        - name: Install Grafana
          ansible.builtin.apt:
            pkg:
              - grafana
              #- grafana-enterprise
            state: present
            update_cache: true
